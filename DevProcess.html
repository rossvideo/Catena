<div class="image-wrapper"
style="background-color: black; padding: 5px;">
<figure>
<img src="images/Catena%20Logo_PMS2191%20&amp;%20White.png"
style="width: 100%;" alt="Catena Logo" />
<figcaption aria-hidden="true">Catena Logo</figcaption>
</figure>
</div>
<h1 id="device-development-process">Device Development Process</h1>
<p>The recommended process is hopefully simple:</p>
<ol type="1">
<li>Design your device model as a set of JSON or YAML files in a file
structure documented <a href="Validation.html">here</a>.
<ol type="1">
<li>[OPTIONAL] Install the recommended Red Hat extension
redhat.vscode-yaml either through vscode or using the command
<code>code --install-extension redhat.vscode-yaml</code>.</li>
</ol></li>
<li>Use
<code>full_service --device_model /path/to/your/device.json</code> to
run your model.</li>
<li>Use Postman to get/set your parameters.</li>
<li>Coming soon … use DashBoard beta to even get a GUI!</li>
<li>If working in C++, replace the placeholder business logic in
<code>full_service.cpp</code> with your own.</li>
</ol>
<p>All interactions with all attached clients are handled by the Catena
Device Model.</p>
<p>In the C++ SDK the DeviceModel provides a signals/slots mechanism to
tell your business logic when a parameter value has been changed by an
attached client. It also provides <code>setValue</code> methods and
alerts connected clients about the value changes if they’re subscribed
to the parameter that was altered. The architecture simplifies to:</p>
<figure>
<img src="images/Catena%20UML%20-%20Device%20Architecture.svg"
alt="alt" />
<figcaption aria-hidden="true">alt</figcaption>
</figure>
<div class="sourceCode" id="cb1"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// This is the business logic for the service</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">// This simple example just increments a number every second,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">// and logs client updates</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">// construction of dm not shown</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>dm<span class="op">.</span>valueSetByClient<span class="op">.</span><span class="fu">connect</span><span class="op">([](</span><span class="at">const</span> ParamAccessor <span class="op">&amp;</span>p<span class="op">,</span> catena<span class="op">::</span>ParamIndex idx<span class="op">,</span> <span class="at">const</span> <span class="bu">std::</span>string<span class="op"> &amp;</span>peer<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    catena<span class="op">::</span>Value v<span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// note that the DeviceModel is locked, </span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// so use the non-locking version of getValue to avoid deadlock.</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    p<span class="op">.</span>getValue<span class="op">&lt;</span><span class="kw">false</span><span class="op">&gt;(&amp;</span>v<span class="op">,</span> idx<span class="op">);</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">&quot;Client &quot;</span> <span class="op">&lt;&lt;</span> peer <span class="op">&lt;&lt;</span> <span class="st">&quot; set &quot;</span> <span class="op">&lt;&lt;</span> p<span class="op">.</span>oid<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="st">&quot; to: &quot;</span> <span class="op">&lt;&lt;</span> printJSON<span class="op">(</span>v<span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// a real service would do something with the value here</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>thread<span class="op"> </span>loop<span class="op">([&amp;</span>dm<span class="op">]()</span> <span class="op">{</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// a real service would possibly send status updates, telemetry or audio meters here</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> a_number <span class="op">=</span> dm<span class="op">.</span>param<span class="op">(</span><span class="st">&quot;/a_number&quot;</span><span class="op">);</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>globalLoop<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>this_thread<span class="bu">::</span>sleep_for<span class="op">(</span><span class="bu">std::</span>chrono<span class="bu">::</span>seconds<span class="op">(</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        a_number<span class="op">-&gt;</span>setValue<span class="op">(</span>i<span class="op">++);</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>loop<span class="op">.</span>detach<span class="op">();</span></span></code></pre></div>
<div style="text-align: center">
<p><a href="Security.html">Next Page: Security</a></p>
</div>
