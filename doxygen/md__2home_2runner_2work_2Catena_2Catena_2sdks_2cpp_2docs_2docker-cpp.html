<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cpp-v0.0.16-15: Using Docker With The Catena C++ SDK</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="doxylogo.png"/></td>
  <td id="projectalign">
   <div id="projectname">cpp-v0.0.16-15
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__2home_2runner_2work_2Catena_2Catena_2sdks_2cpp_2docs_2docker-cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Using Docker With The Catena C++ SDK</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md9"></a> </p>
<h1><a class="anchor" id="autotoc_md10"></a>
Terminal</h1>
<h2><a class="anchor" id="autotoc_md11"></a>
Requirements</h2>
<ul>
<li>Install <a href="https://docs.docker.com/get-docker/">Docker</a> and add it to your system path.</li>
<li>If on Linux, make sure to <a href="https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user">enable docker as non-root user</a>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md12"></a>
VSCode</h1>
<h2><a class="anchor" id="autotoc_md13"></a>
Recommended Extensions</h2>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker">Docker</a>. Additionally, follow the Docker software install instructions listed in the extension if not already set up.</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cmake-tools">Cmake Tools</a> for build setup.</li>
</ul>
<h1><a class="anchor" id="autotoc_md14"></a>
Setting up and Running</h1>
<h2><a class="anchor" id="autotoc_md15"></a>
Setting up Catena Service(s) with Docker</h2>
<p>The diagram below outlines the Catena architecture for containers as well as JWS token authentication.</p>
<div style="text-align: center"></div><div style="text-align: center"><div class="image">
<object type="image/svg+xml" data="Catena.UML.Layered.Services.svg" style="pointer-events: none;"></object>
<div class="caption">
Alt</div></div>
    </div><div style="text-align: center"></div><p>Setting up a Catena service(s) with Docker requires five things:</p><ol type="1">
<li><a href="https://github.com/rossvideo/Catena/blob/main/sdks/cpp/connections/docker/CMakeLists.txt">CMake</a> and <a href="https://github.com/rossvideo/Catena/blob/main/sdks/cpp/connections/docker/catena_status_update_dockerfile">Dockerfiles</a> for initializing docker images with files and entrypoints.</li>
<li>A keycloak server to generate public keys with.</li>
<li>A container set up with Envoy proxy for recieving requests via TLS, validating JWS tokens with the keycloak server, and routing valid requests to their respective service. This can be configured via an <a href="https://github.com/rossvideo/Catena/blob/main/sdks/cpp/connections/docker/envoy/envoy.yaml">envoy.yaml</a> file.</li>
<li>A public and private Docker network for communication between containers. <br  />
</li>
<li>A <a href="https://github.com/rossvideo/Catena/blob/main/sdks/cpp/connections/docker/grpc_compose.yml">Docker compose</a> file to create the containers, connect the service containers to the private network, and connect the Envoy proxy to both networks.</li>
</ol>
<p>For an example of Catena services set up with a Docker image, see the <a href="https://github.com/rossvideo/Catena/tree/main/sdks/cpp/connections/docker">connections/docker</a> folder.</p>
<p><em><b>Note:</b></em> If you wish to run your service without authentication/authorization, you can ignore the keycloak server and Envoy proxy container and simply connect your Catena sevice(s) to the public network. In this case, your service's should also be run with <code>--authz=false</code>.</p>
<p><em><b>Note:</b></em> For setting authorization server and realm via the command line, you will need a dockerfile and entrypoint script for your envoy image which replaces the environment variables found in envoy.yaml. See example above for more info.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Steps to run</h2>
<ol type="1">
<li>Build Catena with <code>cmake -DDOCKER=on</code>.</li>
<li>Navigate to the folder containing your Docker compose file.</li>
<li>Run the file using <code>AUTHZ_SERVER=your.authorization.server REALM=realm docker-compose -f /path/to/your/file up -d</code>.</li>
</ol>
<p>Once your containers are created, you can check their status using <code>docker ps -a</code>. You should have one container per service as well as an additional container running Envoy Proxy.</p>
<p>If one or more of these containers have exited, you can debug using <code>docker logs &lt;container name&gt;</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
